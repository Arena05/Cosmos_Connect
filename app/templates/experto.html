{% extends "base.html" %}
{% block content %}
  <section class="card">
    <h2>Modo Experto</h2>
    <form action="{{ url_for('main.predict_experto') }}" method="post" class="grid-form">
      <div class="row">
        <label>Modelo</label>
        <select name="modelo" id="modelo" onchange="toggleHP()" required>
          <option>Random Forest</option>
          <option>Decision Tree</option>
          <option>Logistic Regression</option>
        </select>
      </div>

      <div id="hp-rf" class="hp">
        <div class="row"><label>n_estimators</label>
          <select name="n_estimators">
            <option>400</option><option>800</option><option selected>1200</option><option>1600</option>
          </select>
        </div>
        <div class="row"><label>max_depth</label>
          <select name="max_depth">
            <option>10</option><option selected>20</option><option>30</option><option>40</option>
          </select>
        </div>
        <div class="row"><label>min_samples_split</label>
          <select name="min_samples_split">
            <option>5</option><option selected>10</option><option>15</option><option>20</option>
          </select>
        </div>
        <div class="row"><label>random_state</label>
          <select name="random_state">
            <option>10</option><option>20</option><option>30</option><option selected>42</option>
          </select>
        </div>
      </div>

      <div id="hp-dt" class="hp" style="display:none;">
        <div class="row"><label>max_depth</label>
          <select name="max_depth">
            <option>5</option><option>8</option><option selected>11</option><option>14</option>
          </select>
        </div>
        <div class="row"><label>min_samples_split</label>
          <select name="min_samples_split">
            <option>5</option><option selected>10</option><option>15</option><option>20</option>
          </select>
        </div>
        <div class="row"><label>min_samples_leaf</label>
          <select name="min_samples_leaf">
            <option>2</option><option selected>4</option><option>6</option><option>8</option>
          </select>
        </div>
        <div class="row"><label>random_state</label>
          <select name="random_state">
            <option>10</option><option>20</option><option>30</option><option selected>42</option>
          </select>
        </div>
      </div>

      <div id="hp-lr" class="hp" style="display:none;">
        <div class="row"><label>C</label>
          <select name="C">
            <option>0.01</option><option>0.1</option><option selected>1</option><option>10</option><option>100</option>
          </select>
        </div>
        <div class="row"><label>max_iter</label>
          <select name="max_iter">
            <option>100</option><option>200</option><option>400</option><option selected>600</option>
          </select>
        </div>
        <div class="row"><label>random_state</label>
          <select name="random_state">
            <option>10</option><option>20</option><option>30</option><option selected>42</option>
          </select>
        </div>
      </div>

      {% for key in features %}
      <div class="row">
        <label for="{{ key }}">{{ labels[key] }}</label>
        <input type="number" step="any" name="{{ key }}" id="{{ key }}" required placeholder="0.0">
      </div>
      {% endfor %}

      <div class="row">
        <label>Incluir mis datos añadidos</label>
        <input type="checkbox" name="use_user_data">
      </div>
      <button type="submit" class="btn">Predecir</button>
    </form>
  </section>

  <script>
    function toggleHP() { 
      const m = document.getElementById('modelo').value;
      document.getElementById('hp-rf').style.display = (m==='Random Forest')?'contents':'none';
      document.getElementById('hp-dt').style.display = (m==='Decision Tree')?'contents':'none';
      document.getElementById('hp-lr').style.display = (m==='Logistic Regression')?'contents':'none';
    }
    window.addEventListener('DOMContentLoaded', toggleHP);
  </script>

  <section class="card muted">
    <h3>Tus datos</h3>
    <form action="{{ url_for('main.clear_my_data') }}" method="post" onsubmit="return confirm('¿Eliminar todas tus muestras?');">
      <input type="hidden" name="mode" value="experto">
      <button class="btn warn" type="submit">Eliminar mis datos añadidos</button>
    </form>
  </section>
{% endblock %}
