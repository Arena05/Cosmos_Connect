{% extends "base.html" %}
{% block content %}
<section class="dashboard-hero">
  <div class="container">

    <!-- Cabecera de perfil (ligera y compatible con tu UI) -->
    <div class="cardx p-4 mb-3">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-3">
        <div class="d-flex align-items-center gap-3">
          <div class="rounded-circle bg-light text-dark d-flex align-items-center justify-content-center"
               style="width:56px;height:56px;font-weight:600;">
            {{ (user.name or user.email)[0]|upper }}
          </div>
          <div>
            <h4 class="mb-0">{{ user.name or user.email }}</h4>
            <div class="text-light-70 small">Explorador de Estrellas</div>
          </div>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-cta-2" href="{{ url_for('main.expertos') }}">Ir a Expertos</a>
          <a class="btn btn-outline-light" href="{{ url_for('main.menu') }}">Volver al Men√∫</a>
        </div>
      </div>

      <div class="mt-3">
        <div class="text-light-70 small mb-1">Nivel 3: Buscador de C√∫mulos</div>
        <div class="progress" role="progressbar" aria-label="xp" style="height:8px;">
          <div class="progress-bar" style="width: 62%"></div>
        </div>
        <div class="text-light-70 small mt-1">2500/5000 XP</div>
      </div>
    </div>

    <!-- ======================= MIS EXPERIMENTOS ======================= -->
    <div class="cardx p-3">
      <div class="d-flex justify-content-between align-items-center">
        <h5 class="mb-0">Mis Experimentos (recientes)</h5>
        <span class="text-light-70 small">
          Total: {{ experiments|length }}
        </span>
      </div>

      {% if experiments and experiments|length > 0 %}
      <div class="table-responsive mt-3">
        <table class="table table-dark table-sm align-middle">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Modelo</th>
              <th>Prob.</th>
              <th>Clase</th>
              <th style="width:140px;">Acciones</th>
            </tr>
          </thead>
          <tbody>
          {% for ex in experiments %}
            <tr>
              <td>{{ ex.created_at.strftime('%d/%m/%Y %H:%M') if ex.created_at else '-' }}</td>
              <td>{{ ex.model_name }}</td>
              <td>{{ (ex.prob * 100)|round(1) }}%</td>
              <td>{{ ex.predicted_class }}</td>
              <td>
                <button class="btn btn-outline-light btn-sm"
                        type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#exp{{ ex.id }}">
                  Ver detalles
                </button>
              </td>
            </tr>
            <tr class="collapse" id="exp{{ ex.id }}">
              <td colspan="5">
                <div class="row g-3">
                  <div class="col-lg-6">
                    <div class="cardx p-2 h-100">
                      <div class="small text-light-70 mb-1">Par√°metros</div>
                      <pre class="mb-0 small" style="white-space: pre-wrap;">{{ ex.params|tojson(indent=2) }}</pre>
                    </div>
                  </div>
                  <div class="col-lg-6">
                    <div class="cardx p-2 h-100">
                      <div class="small text-light-70 mb-1">Criterios</div>
                      <pre class="mb-0 small" style="white-space: pre-wrap;">{{ ex.criteria|tojson(indent=2) }}</pre>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
        <div class="text-light-70 small mt-3">
          A√∫n no has guardado experimentos. Ejecuta un an√°lisis en <a href="{{ url_for('main.aprendiz') }}">Aprendiz</a>
          o <a href="{{ url_for('main.expertos') }}">Expertos</a> y pulsa <strong>‚ÄúGuardar experimento‚Äù</strong>. üöÄ
        </div>
      {% endif %}
    </div>

  </div>
</section>
{% endblock %}
